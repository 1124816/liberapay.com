{% from 'templates/avatar-url.html' import avatar_img with context %}

{% macro account_row(platform, accounts, auth_button) %}
    {% set account = accounts.get(platform.name, None) %}
    <tr class="{{ 'has-avatar' if account }}">
        <td class="account-type">
            <div class="sanity-preserving-wrapper">
                {% if account != None %}
                    {{ avatar_img(account) }}
                {% endif %}
              <img class="platform" src="{{ platform.logo }}" />
            </div>
        </td>
        <td class="account-details">
            {% if account %}
                <a class="account-username" rel="me" href="{{ account.html_url }}"
                    >{{ account.friendly_name_long }}
                </a>
            {% endif %}

            <div class="account-type">{{ platform.display_name }}</div>
        </td>
        <td class="account-action">
            {% if user == participant %}
                {% if account == None %}
                    {% set allow_team = participant.kind == 'organization' and platform.is_team_admin %}
                    {% set cls = allow_team and 'user_name_prompt' or '' %}
                    {% call auth_button(platform.name, 'connect', class=cls) %}
                        {{ _("+ Add") }}
                    {% endcall %}
                {% else %}
                    <form action="/{{ account.participant.username }}/elsewhere/delete"
                          method="POST" class="js-submit">
                         <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                         <input type="hidden" name="platform" value="{{ platform.name }}">
                         <input type="hidden" name="user_id" value="{{ account.user_id }}">
                         <button class="account-delete" title="{{ _('Disconnect') }}"></button>
                    </form>
                {% endif %}
            {% endif %}
        </td>
    </tr>
{% endmacro %}
